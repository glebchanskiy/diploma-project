@startuml
title "Формирование Прозрачного Ответа"

start
:Пользователь отправляет запрос;

partition "Ядро Системы" {
  :Первичный анализ запроса (LLM);
  :Определение начальных узлов в Базе Знаний (БЗ);

  repeat :Итерация навигации по БЗ
    :Запрос к LLM:\n  - Текущий контекст/путь\n  - Доступные дочерние узлы БЗ\n  - Исходный запрос;
    :LLM анализирует и рекомендует:\n  - Следующий узел для углубления\n  - ИЛИ узел с финальным ответом\n  - ИЛИ указывает на нехватку информации;
    if (LLM рекомендует финальный ответ?) then (да)
      :Извлечение полного ответа\nиз целевого узла БЗ;
      :Фиксация пути решения;
      stop
    elseif (LLM рекомендует узел для углубления?) then (да)
      :Переход к рекомендованному узлу БЗ;
      :Обновление текущего пути;
    else (нет подходящих узлов / лимит итераций)
      :Формирование ответа:\n"Информация не найдена";
      :Фиксация попыток поиска;
      stop
    endif
  repeat while (Ответ не найден И лимит итераций не достигнут) is (продолжать)
}

@enduml